box:
  id: {{.UserName}}/qmk_firmware-{{.Keyboard}}-${{.Subproject}}-{{.Keymap}}

build:
  steps:
    - script:
        name: build default keymap.
        cwd: $WERCKER_SOURCE_DIR
        code: |
          make keyboard={{.Keyboard}} keymap={{.Keymap}}
    - script:
        name: move built firmware to output dir.
        cwd: $WERCKER_SOURCE_DIR/.build
        code: |
          mv {{.Keyboard}}_{{.Project}}_{{.Keymap}}.hex $WERCKER_OUTPUT_DIR/{{.Keyboard}}-{{.Project}}-{{.Keymap}}.hex
deploy:
  steps:
    - script:
        name: put built hex file to bintray.
        code: |
          curl -T $WERCKER_SOURCE_DIR/{{.Keyboard}}-{{.Project}}-{{.Keymap}}.hex -u$BINTRAY_USERNAME:$BINTRAY_APIKEY https://api.bintray.com/content/$BINTRAY_USERNAME/generic/ergodox.hex/$WERCKER_GIT_BRANCH-$WERCKER_GIT_COMMIT/{{.Keyboard}}-{{.Project}}-{{.Keymap}}.hex
    - script:
        name: publish uploaded hex file.
        code: |
          curl -X POST -u$BINTRAY_USERNAME:$BINTRAY_APIKEY https://api.bintray.com/content/$BINTRAY_USERNAME/generic/ergodox.hex/$WERCKER_GIT_BRANCH-$WERCKER_GIT_COMMIT/publish
